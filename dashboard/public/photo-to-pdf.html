<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; worker-src 'self' blob: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://cdn.jsdelivr.net https://unpkg.com https://tessdata.projectnaptha.com; connect-src 'self' https://cdn.jsdelivr.net https://unpkg.com https://tessdata.projectnaptha.com;">
    <title>Photo to PDF Scanner - Web App</title>
    <link rel="stylesheet" href="photo-to-pdf.css">
    <script src="libs/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@4/dist/tesseract.min.js"></script>
    <script>
        // Initialize PDF.js
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
            console.log('âœ… PDF.js initialized successfully');
        } else {
            console.error('âŒ PDF.js failed to load');
        }
        
        // Check Tesseract loading
        window.tesseractReady = false;
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof Tesseract !== 'undefined') {
                    window.tesseractReady = true;
                    console.log('âœ… Tesseract.js loaded successfully');
                } else {
                    console.error('âŒ Tesseract.js failed to load');
                }
            }, 1000);
        });
    </script>
</head>
<body>
    <div id="app" class="container">
        <div class="header">
            <h1 class="title">ğŸ“¸ Photo to PDF Scanner</h1>
            <a href="/#apps" class="back-link">â† Back to Dashboard</a>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="capture">ğŸ“· Capture</button>
            <button class="tab-btn" data-tab="documents">ğŸ“„ Documents</button>
            <button class="tab-btn" data-tab="settings">âš™ï¸ Settings</button>
        </div>

        <!-- Capture Tab -->
        <div id="captureTab" class="tab-content active">
            <div class="capture-container">
                <div class="camera-section">
                    <div class="camera-container" id="cameraContainer">
                        <video id="cameraVideo" autoplay playsinline></video>
                        <canvas id="captureCanvas" class="hidden"></canvas>
                        <div class="camera-overlay">
                            <div class="capture-guide">
                                <div class="guide-corners"></div>
                                <p class="guide-text">Position document within frame</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button id="startCameraBtn" class="control-btn start-camera">
                            ğŸ“¹ Start Camera
                        </button>
                        <button id="captureBtn" class="control-btn capture hidden">
                            ğŸ“¸ Capture
                        </button>
                        <button id="stopCameraBtn" class="control-btn stop-camera hidden">
                            â¹ï¸ Stop Camera
                        </button>
                    </div>
                    
                    <div class="file-upload-section">
                        <p class="upload-text">Or upload images from your device:</p>
                        <div class="file-upload-container">
                            <input type="file" id="fileInput" accept="image/*" multiple class="file-input">
                            <label for="fileInput" class="file-upload-btn">
                                ğŸ–¼ï¸ Choose Images
                            </label>
                        </div>
                    </div>
                </div>

                <div class="preview-section">
                    <div class="images-preview" id="imagesPreview">
                        <div class="preview-placeholder">
                            <div class="placeholder-icon">ğŸ“¸</div>
                            <p>Captured images will appear here</p>
                        </div>
                    </div>
                    
                    <div class="workflow-info">
                        <h3>ğŸ“‹ Workflow</h3>
                        <div class="workflow-steps">
                            <p>1. Capture or upload images</p>
                            <p>2. Generate PDF document</p>
                            <p>3. Extract text from PDF (optional)</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button id="generatePdfBtn" class="action-btn pdf-btn" disabled>
                    ğŸ“„ Generate PDF
                </button>
                <button id="clearAllBtn" class="action-btn clear-btn">
                    ğŸ—‘ï¸ Clear All
                </button>
            </div>
        </div>

        <!-- Documents Tab -->
        <div id="documentsTab" class="tab-content hidden">
            <div class="documents-header">
                <h2>ğŸ“‹ Saved Documents</h2>
                <div class="documents-stats">
                    <span class="stat">
                        <span class="stat-number" id="totalDocs">0</span>
                        <span class="stat-label">Documents</span>
                    </span>
                </div>
            </div>
            
            <div class="documents-content">
                <div class="documents-list" id="documentsList">
                    <div class="empty-documents">
                        <div class="empty-icon">ğŸ“„</div>
                        <p>No documents yet</p>
                        <small>Capture and process images to create your first PDF document</small>
                    </div>
                </div>
                
                <div class="ocr-panel" id="ocrPanel" style="display: none;">
                    <div class="ocr-header">
                        <h3>ğŸ” Extracted Text</h3>
                        <button class="close-ocr-panel" id="closeOcrPanel">Ã—</button>
                    </div>
                    <div class="ocr-content">
                        <div class="ocr-progress hidden" id="documentsOcrProgress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="documentsProgressFill"></div>
                            </div>
                            <p class="progress-text" id="documentsProgressText">Processing...</p>
                        </div>
                        <textarea id="documentsOcrText" placeholder="Extracted text will appear here..." readonly></textarea>
                        <div class="ocr-actions">
                            <button class="ocr-action-btn" id="copyOcrText">ğŸ“‹ Copy Text</button>
                            <button class="ocr-action-btn" id="saveOcrText">ğŸ’¾ Save to Document</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content hidden">
            <div class="settings-section">
                <h2>âš™ï¸ Scanner Settings</h2>
                
                
                <div class="setting-group">
                    <h3>PDF Settings</h3>
                    <div class="setting-item">
                        <label for="pdfQuality">Image Quality:</label>
                        <select id="pdfQuality">
                            <option value="high">High (Larger file)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="low">Low (Smaller file)</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>Camera Settings</h3>
                    <div class="setting-item">
                        <label for="autoCapture">
                            <input type="checkbox" id="autoCapture">
                            Auto-capture when document detected
                        </label>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>Storage & Backup</h3>
                    <div class="setting-item">
                        <label for="autoDownload">
                            <input type="checkbox" id="autoDownload">
                            Auto-download PDFs when storage is nearly full
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="persistentStorage">
                            <input type="checkbox" id="persistentStorage">
                            Request persistent storage (prevents automatic cleanup)
                        </label>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>Storage Usage</h3>
                    <div class="storage-info">
                        <div class="storage-usage">
                            <div class="storage-bar">
                                <div class="storage-fill" style="width: 0%"></div>
                            </div>
                            <p>Checking storage usage...</p>
                        </div>
                    </div>
                    <div class="storage-actions">
                        <button id="downloadAllBtn" class="storage-btn">ğŸ“¥ Download All Documents</button>
                        <button id="clearStorageBtn" class="storage-btn warning">ğŸ—‘ï¸ Clear All Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="photo-to-pdf.js"></script>
    <script src="storage-methods.js"></script>
</body>
</html>