import{r as i,a as Ke,N as Ue,u as ke,L as Ae,b as qe,B as Qe,R as es,c as je,d as ss}from"./vendor-ycPT9Mzr.js";import{a as Ye,l as _e}from"./api-Bs1G8lkK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(l){if(l.ep)return;l.ep=!0;const d=n(l);fetch(l.href,d)}})();var Xe={exports:{}},Ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ts=i,rs=Symbol.for("react.element"),as=Symbol.for("react.fragment"),ns=Object.prototype.hasOwnProperty,os=ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,is={key:!0,ref:!0,__self:!0,__source:!0};function We(s,t,n){var r,l={},d=null,f=null;n!==void 0&&(d=""+n),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(f=t.ref);for(r in t)ns.call(t,r)&&!is.hasOwnProperty(r)&&(l[r]=t[r]);if(s&&s.defaultProps)for(r in t=s.defaultProps,t)l[r]===void 0&&(l[r]=t[r]);return{$$typeof:rs,type:s,key:d,ref:f,props:l,_owner:os.current}}Ee.Fragment=as;Ee.jsx=We;Ee.jsxs=We;Xe.exports=Ee;var e=Xe.exports,Le={},Oe=Ke;Le.createRoot=Oe.createRoot,Le.hydrateRoot=Oe.hydrateRoot;const cs="/territory-api";let te=null,$e=[];const _=Ye.create({baseURL:cs,withCredentials:!0,timeout:3e4});_.interceptors.request.use(s=>{var t;return console.log("üì§ API Request:",{url:s.url,method:(t=s.method)==null?void 0:t.toUpperCase(),hasToken:!!te,tokenStart:te?te.substring(0,20)+"...":"none",timestamp:new Date().toLocaleTimeString()}),te&&!s.url.includes("/auth/")&&(s.headers.Authorization=`Bearer ${te}`),s},s=>Promise.reject(s));let Me=!1,ze=[];const ls=s=>{ze.push(s)},ds=s=>{ze.forEach(t=>t(s)),ze=[]};_.interceptors.response.use(s=>s,async s=>{var n,r,l,d;const t=s.config;if(console.log("üîç API Error Interceptor:",{url:t.url,status:(n=s.response)==null?void 0:n.status,data:(r=s.response)==null?void 0:r.data,hasToken:!!te,isRetry:t._retry,timestamp:new Date().toLocaleTimeString()}),((l=s.response)==null?void 0:l.status)===401&&!t._retry&&!t.url.includes("/auth/")){if(console.log("üîÑ Attempting token refresh..."),Me)return console.log("‚è≥ Token refresh already in progress, queuing request..."),new Promise(f=>{ls(w=>{t.headers.Authorization=`Bearer ${w}`,f(_(t))})});t._retry=!0,Me=!0;try{return console.log("üöÄ Calling refresh endpoint..."),te=(await _.post("/auth/refresh")).data.accessToken,$e.forEach(w=>w(te)),console.log("‚úÖ Token refreshed successfully"),ds(te),t.headers.Authorization=`Bearer ${te}`,console.log("üîÅ Retrying original request..."),_(t)}catch(f){return console.log("‚ùå Token refresh failed:",(d=f.response)==null?void 0:d.data),te=null,console.log("üö™ Redirecting to login..."),window.location.href="/login",Promise.reject(f)}finally{Me=!1}}return Promise.reject(s)});const Re=s=>{te=s,$e.forEach(t=>t(s))},ms=()=>{te=null,$e.forEach(s=>s(null))},us=s=>{$e.push(s)},Ce={signup:(s,t,n)=>_.post("/auth/signup",{email:s,username:t,password:n}),login:(s,t)=>_.post("/auth/login",{email:s,password:t}),logout:()=>_.post("/auth/logout"),refresh:()=>_.post("/auth/refresh")},we={getGames:()=>_.get("/games"),createGame:(s,t,n=2)=>_.post("/games",{title:s,gameType:t,maxPlayers:n}),getGame:s=>_.get(`/games/${s}`),joinGame:s=>_.post(`/games/${s}/join`),addPlayer:(s,t)=>_.post(`/games/${s}/players`,{identifier:t}),makeMove:(s,t)=>_.post(`/games/${s}/moves`,{moveData:t}),updateGameState:(s,t,n,r)=>_.put(`/games/${s}/state`,{gameState:t,status:n,winnerId:r}),deleteGame:s=>_.delete(`/games/${s}`)},hs="/territory-api",ie=Ye.create({baseURL:hs,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});let ce=null;us(s=>{ce=s});ie.interceptors.request.use(s=>{var t;return console.log("üéØ Territory API Request:",{url:s.url,method:(t=s.method)==null?void 0:t.toUpperCase(),hasToken:!!ce,tokenStart:ce?ce.substring(0,20)+"...":"none",timestamp:new Date().toLocaleTimeString()}),ce&&(s.headers.Authorization=`Bearer ${ce}`),s},s=>Promise.reject(s));ie.interceptors.response.use(s=>(console.log("‚úÖ Territory API Response:",{url:s.config.url,status:s.status,timestamp:new Date().toLocaleTimeString()}),s),async s=>{var n,r,l,d,f;const t=s.config;if(console.log("‚ùå Territory API Error:",{url:(t==null?void 0:t.url)||"unknown",status:(n=s.response)==null?void 0:n.status,data:(r=s.response)==null?void 0:r.data,message:s.message,code:s.code,timestamp:new Date().toLocaleTimeString()}),s.code==="ECONNABORTED"||(l=s.message)!=null&&l.includes("timeout"))return console.log("‚è±Ô∏è Request timed out after 30 seconds"),s.customMessage="Request timed out. The server may be experiencing high load.",Promise.reject(s);if(!s.response&&s.message==="Network Error")return console.log("üîå Network error - cannot reach server"),s.customMessage="Cannot connect to server. Please check your connection.",Promise.reject(s);if((d=s.message)!=null&&d.includes("aborted"))return console.log("üö´ Request was aborted, not retrying"),Promise.reject(s);if(((f=s.response)==null?void 0:f.status)===401&&!t._retry){console.log("üîÑ Territory API: Attempting token refresh..."),t._retry=!0;try{if(ce=(await ie.post("/auth/refresh")).data.accessToken,console.log("‚úÖ Territory API: Token refreshed"),ce)return t.headers.Authorization=`Bearer ${ce}`,ie(t)}catch(w){return console.log("‚ùå Territory API: Token refresh failed, redirecting to login"),window.location.href="/login",Promise.reject(w)}}return Promise.reject(s)});const ne={setAuthToken:s=>{ce=s},createGame:async s=>(await ie.post("/territory/create",{title:s})).data,joinGame:async s=>(await ie.post(`/territory/${s}/join`)).data,getRegion:async(s,t)=>{const n=new URLSearchParams({minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY});return(await ie.get(`/territory/${s}/region?${n}`)).data},getAvailableMoves:async s=>(await ie.get(`/territory/${s}/moves`)).data,makeMove:async(s,t,n)=>(await ie.post(`/territory/${s}/move`,{x:t,y:n})).data,addPlayer:async(s,t)=>(await ie.post(`/territory/${s}/players`,{identifier:t})).data,getScoreboard:async s=>(await ie.get(`/territory/${s}/scoreboard`)).data},He=i.createContext(),ve=()=>{const s=i.useContext(He);if(!s)throw new Error("useAuth must be used within AuthProvider");return s},ps=({children:s})=>{const[t,n]=i.useState(null),[r,l]=i.useState(!0);i.useEffect(()=>{d()},[]);const d=async()=>{try{const S=await Ce.refresh();n(S.data.user),Re(S.data.accessToken),ne.setAuthToken(S.data.accessToken)}catch{console.log("Not authenticated")}finally{l(!1)}},g={user:t,loading:r,signup:async(S,G,b)=>{const C=await Ce.signup(S,G,b);return n(C.data.user),Re(C.data.accessToken),ne.setAuthToken(C.data.accessToken),C.data},login:async(S,G)=>{const b=await Ce.login(S,G);return n(b.data.user),Re(b.data.accessToken),ne.setAuthToken(b.data.accessToken),b.data},logout:async()=>{try{await Ce.logout()}catch(S){console.error("Logout error:",S)}finally{n(null),ms(),ne.setAuthToken(null)}}};return e.jsx(He.Provider,{value:g,children:s})},Je=i.createContext(),Fe=()=>{const s=i.useContext(Je);if(!s)throw new Error("useTheme must be used within a ThemeProvider");return s},gs=({children:s})=>{const[t,n]=i.useState(()=>localStorage.getItem("game-theme")||"dark");i.useEffect(()=>{localStorage.setItem("game-theme",t),document.documentElement.setAttribute("data-theme",t)},[t]);const l={theme:t,toggleTheme:()=>{n(d=>d==="dark"?"light":"dark")},isDark:t==="dark",isLight:t==="light"};return e.jsx(Je.Provider,{value:l,children:s})},Pe=({children:s})=>{const{user:t,loading:n}=ve();return n?e.jsx("div",{className:"loading",children:"Loading..."}):t?s:e.jsx(Ue,{to:"/login",replace:!0})},xs=()=>{const[s,t]=i.useState(""),[n,r]=i.useState(""),[l,d]=i.useState(!1),[f,w]=i.useState(""),[F,g]=i.useState(""),[S,G]=i.useState([]),[b,C]=i.useState(null),{login:O}=ve(),X=ke(),$=(y,p="info")=>{const N=new Date().toLocaleTimeString();G(T=>[...T.slice(-9),{timestamp:N,message:y,type:p}])},K=async()=>{g("Testing API connection..."),$("Starting API health check","info");try{const y="/territory-api/health";g(`Testing: ${y}`),$(`Testing URL: ${y}`,"info");const p=performance.now(),N=await fetch(y,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)}),T=Math.round(performance.now()-p);if($(`Response time: ${T}ms`,"success"),$(`Status: ${N.status} ${N.statusText}`,N.ok?"success":"error"),!N.ok)throw new Error(`HTTP ${N.status}: ${N.statusText}`);const A=await N.json();g(`‚úÖ API OK | URL: ${y} | Response: ${JSON.stringify(A)}`),$(`API Response: ${JSON.stringify(A)}`,"success")}catch(y){$(`Error: ${y.message}`,"error"),y.name==="TimeoutError"||y.message.includes("timeout")?g("‚ùå TIMEOUT | URL might be wrong or server down | Tried: /territory-api"):y.name==="TypeError"&&y.message.includes("fetch")?(g("‚ùå NETWORK ERROR | Can't reach server | Check if territory backend is running"),$("Network error - server unreachable","error")):g(`‚ùå API FAILED | Error: ${y.message} | Type: ${y.name}`)}},q=y=>{y==="alice"?(t("alice@example.com"),r("password123")):(t("bob@example.com"),r("password456")),g("Test credentials filled")},W=async y=>{var p,N,T,A,Q,R,B,le,U,v,de;y.preventDefault(),d(!0),w(""),g("Starting login..."),$(`Login attempt for: ${s}`,"info"),C(null);try{$("Login URL: /territory-api/auth/login","info"),g("Calling API...");const x=performance.now();await O(s,n);const D=Math.round(performance.now()-x);$(`Login successful in ${D}ms`,"success"),g("Login successful, redirecting..."),X("/dashboard")}catch(m){const x=((N=(p=m.response)==null?void 0:p.config)==null?void 0:N.responseTime)||"unknown",D=((A=(T=m.response)==null?void 0:T.data)==null?void 0:A.error)||m.message||"Login failed",P=((Q=m.response)==null?void 0:Q.status)||"Unknown",H=((R=m.response)==null?void 0:R.statusText)||"No status text",c="/territory-api",k=((le=(B=m.response)==null?void 0:B.config)==null?void 0:le.url)||"Unknown URL";w(D),C({message:D,status:P,statusText:H,url:k,responseTime:x,details:((U=m.response)==null?void 0:U.data)||{},timestamp:new Date().toISOString()}),$(`Login failed: ${D}`,"error"),$(`Status: ${P} ${H}`,"error"),$(`Response time: ${x}`,"error"),(v=m.response)!=null&&v.data&&$(`Server response: ${JSON.stringify(m.response.data)}`,"error"),g(`‚ùå LOGIN FAILED | Error: ${D} | Status: ${P} | API: ${c}`),console.error("Login error details:",{error:m,response:m.response,message:m.message,stack:m.stack,config:(de=m.response)==null?void 0:de.config})}finally{d(!1)}};return e.jsxs("div",{className:"territory-auth-container",children:[e.jsx("div",{className:"territory-grid-bg"}),e.jsx("div",{className:"territory-auth-overlay",children:e.jsxs("div",{className:"territory-auth-form",children:[e.jsxs("div",{className:"territory-logo-section",children:[e.jsx("div",{className:"territory-logo",children:e.jsxs("div",{className:"logo-grid",children:[e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell player2"}),e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player2"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player2"})]})}),e.jsx("h1",{children:"Territory Conquest"}),e.jsx("p",{className:"territory-tagline",children:"Claim your domain. Expand your empire."})]}),f&&e.jsx("div",{className:"territory-error",children:f}),F&&e.jsx("div",{className:"territory-debug-info",children:F}),e.jsxs("div",{className:"territory-connection-info",children:[e.jsxs("small",{children:[e.jsx("strong",{children:"API:"})," ","/territory-api"," (Production)"]}),e.jsx("br",{}),e.jsxs("small",{children:[e.jsx("strong",{children:"Host:"})," ",typeof window<"u"?window.location.host:"N/A"]}),e.jsx("br",{}),e.jsxs("small",{children:[e.jsx("strong",{children:"Protocol:"})," ",typeof window<"u"?window.location.protocol:"N/A"]}),e.jsx("br",{}),e.jsxs("small",{children:[e.jsx("strong",{children:"User Agent:"})," ",typeof navigator<"u"?navigator.userAgent.substring(0,50)+"...":"N/A"]})]}),e.jsxs("div",{className:"territory-test-section",children:[e.jsx("h3",{children:"Diagnostics & Quick Access"}),e.jsxs("div",{className:"territory-test-buttons",children:[e.jsx("button",{type:"button",className:"territory-btn-test api",onClick:K,children:"üîó Test API"}),e.jsx("button",{type:"button",className:"territory-btn-test alice",onClick:()=>q("alice"),children:"üë§ Alice"}),e.jsx("button",{type:"button",className:"territory-btn-test bob",onClick:()=>q("bob"),children:"üë§ Bob"})]}),e.jsxs("div",{className:"territory-test-buttons",children:[e.jsx("button",{type:"button",className:"territory-btn-test direct",onClick:()=>window.open(`${window.location.origin}/territory-api/health`,"_blank"),children:"üöÄ Direct API Test"}),e.jsx("button",{type:"button",className:"territory-btn-test clear",onClick:()=>{G([]),C(null),g("")},children:"üóëÔ∏è Clear Logs"})]}),S.length>0&&e.jsxs("div",{className:"territory-diagnostics-log",children:[e.jsx("h4",{children:"Network Activity Log"}),e.jsx("div",{className:"diagnostics-entries",children:S.map((y,p)=>e.jsxs("div",{className:`diagnostic-entry ${y.type}`,children:[e.jsx("span",{className:"diagnostic-time",children:y.timestamp}),e.jsx("span",{className:"diagnostic-message",children:y.message})]},p))})]}),b&&e.jsxs("div",{className:"territory-error-details",children:[e.jsx("h4",{children:"Last Error Details"}),e.jsxs("div",{className:"error-detail-item",children:[e.jsx("strong",{children:"Message:"})," ",b.message]}),e.jsxs("div",{className:"error-detail-item",children:[e.jsx("strong",{children:"Status:"})," ",b.status," ",b.statusText]}),e.jsxs("div",{className:"error-detail-item",children:[e.jsx("strong",{children:"URL:"})," ",b.url]}),e.jsxs("div",{className:"error-detail-item",children:[e.jsx("strong",{children:"Time:"})," ",new Date(b.timestamp).toLocaleString()]}),Object.keys(b.details).length>0&&e.jsxs("div",{className:"error-detail-item",children:[e.jsx("strong",{children:"Response:"}),e.jsx("pre",{children:JSON.stringify(b.details,null,2)})]})]})]}),e.jsxs("form",{onSubmit:W,className:"territory-form",children:[e.jsx("div",{className:"territory-form-group",children:e.jsx("input",{type:"email",placeholder:"Email Address",value:s,onChange:y=>t(y.target.value),required:!0,className:"territory-input"})}),e.jsx("div",{className:"territory-form-group",children:e.jsx("input",{type:"password",placeholder:"Password",value:n,onChange:y=>r(y.target.value),required:!0,className:"territory-input"})}),e.jsxs("button",{type:"submit",disabled:l,className:"territory-login-btn",children:[e.jsx("span",{className:"btn-grid-effect"}),l?"‚ö° Connecting...":"üèÅ Enter Battle"]})]}),e.jsx("div",{className:"territory-signup-link",children:e.jsxs("p",{children:["New commander? ",e.jsx(Ae,{to:"/signup",className:"territory-link",children:"Join the conquest"})]})})]})})]})},fs=()=>{const[s,t]=i.useState(""),[n,r]=i.useState(""),[l,d]=i.useState(""),[f,w]=i.useState(!1),[F,g]=i.useState(""),{signup:S}=ve(),G=ke(),b=async C=>{var O,X;C.preventDefault(),w(!0),g("");try{await S(s,n,l),G("/dashboard")}catch($){g(((X=(O=$.response)==null?void 0:O.data)==null?void 0:X.error)||"Signup failed")}finally{w(!1)}};return e.jsxs("div",{className:"territory-auth-container",children:[e.jsx("div",{className:"territory-grid-bg"}),e.jsx("div",{className:"territory-auth-overlay",children:e.jsxs("div",{className:"territory-auth-form",children:[e.jsxs("div",{className:"territory-logo-section",children:[e.jsx("div",{className:"territory-logo",children:e.jsxs("div",{className:"logo-grid",children:[e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell player2"}),e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player2"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player1"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell player2"})]})}),e.jsx("h1",{children:"Join the Conquest"}),e.jsx("p",{className:"territory-tagline",children:"Establish your command. Build your empire."})]}),F&&e.jsx("div",{className:"territory-error",children:F}),e.jsxs("form",{onSubmit:b,className:"territory-form",children:[e.jsx("div",{className:"territory-form-group",children:e.jsx("input",{type:"email",placeholder:"Email Address",value:s,onChange:C=>t(C.target.value),required:!0,className:"territory-input"})}),e.jsx("div",{className:"territory-form-group",children:e.jsx("input",{type:"text",placeholder:"Commander Username",value:n,onChange:C=>r(C.target.value),required:!0,className:"territory-input"})}),e.jsx("div",{className:"territory-form-group",children:e.jsx("input",{type:"password",placeholder:"Password (minimum 6 characters)",value:l,onChange:C=>d(C.target.value),required:!0,minLength:6,className:"territory-input"})}),e.jsxs("button",{type:"submit",disabled:f,className:"territory-login-btn",children:[e.jsx("span",{className:"btn-grid-effect"}),f?"‚ö° Establishing Command...":"üöÄ Begin Conquest"]})]}),e.jsx("div",{className:"territory-signup-link",children:e.jsxs("p",{children:["Already a commander? ",e.jsx(Ae,{to:"/login",className:"territory-link",children:"Enter the battle"})]})})]})})]})},ys=()=>{var H;const[s,t]=i.useState([]),[n,r]=i.useState(!0),[l,d]=i.useState(!1),[f,w]=i.useState(!1),[F,g]=i.useState([{message:"Dashboard initialized",type:"info",timestamp:new Date().toLocaleTimeString()},{message:`Base URL: ${window.location.origin}${window.location.pathname}`,type:"info",timestamp:new Date().toLocaleTimeString()},{message:"API configured: /territory-api",type:"info",timestamp:new Date().toLocaleTimeString()}]),[S,G]=i.useState(!0),[b,C]=i.useState(!0),[O,X]=i.useState({title:"",gameType:"territory",maxPlayers:8}),[$,K]=i.useState(null),[q,W]=i.useState(""),[y,p]=i.useState(!1),[N,T]=i.useState(null),[A,Q]=i.useState(!1),{user:R,logout:B}=ve(),le=ke();i.useEffect(()=>{v("Dashboard component mounted"),v(`User authenticated: ${R?R.username:"No user"}`,R?"success":"error"),v(`Environment: ${window.location.hostname}`),U()},[]);const U=async()=>{var c;try{v("Loading games list...");const k=await we.getGames();v(`Loaded ${k.data.length} games`,"success"),t(k.data)}catch(k){console.error("Failed to load games:",k),v(`Failed to load games: ${k.message}`,"error"),((c=k.response)==null?void 0:c.status)===401&&v("Authentication failed - redirecting to login","error")}finally{r(!1)}},v=(c,k="info")=>{const z=new Date().toLocaleTimeString();g(E=>[...E,{message:c,type:k,timestamp:z}]),console.log(`[${z}] ${k.toUpperCase()}: ${c}`)},de=async c=>{var k,z;c.preventDefault(),d(!0),g([]),v("Starting game creation...");try{v(`Creating territory game: "${O.title}"`),v("Checking authentication token..."),v("Calling territory API...");const E=await ne.createGame(O.title);v(`Territory game created successfully! ID: ${E.id}`,"success"),v("Navigating to game..."),le(`/territory/${E.id}`),v("Cleaning up form...","success"),w(!1),X({title:"",gameType:"territory",maxPlayers:8})}catch(E){console.error("Failed to create game:",E),v(`ERROR: ${E.message}`,"error"),E.response?(v(`HTTP Status: ${E.response.status}`,"error"),v(`Response data: ${JSON.stringify(E.response.data)}`,"error"),E.response.status===401?v("Authentication failed - token might be expired","error"):E.response.status===429&&v("Rate limit exceeded - too many requests","error")):E.request&&v("Network error - no response from server","error"),alert(`Failed to create game: ${((z=(k=E.response)==null?void 0:k.data)==null?void 0:z.error)||E.message}`)}finally{d(!1),v("Game creation process completed.")}},m=async(c,k)=>{var z,E,V,Y;p(!0);try{await ne.addPlayer(c,k),v(`Added player ${k} to territory game`,"success"),await U(),K(null),W("")}catch(me){console.error("Failed to add player:",me),v(`Failed to add player: ${(E=(z=me.response)==null?void 0:z.data)==null?void 0:E.error}`,"error"),alert(((Y=(V=me.response)==null?void 0:V.data)==null?void 0:Y.error)||"Failed to add player")}finally{p(!1)}},x=async c=>{var k,z,E,V;Q(!0);try{await we.deleteGame(c),v(`Deleted territory game ${c}`,"success"),await U(),T(null)}catch(Y){console.error("Failed to delete game:",Y),v(`Failed to delete game: ${(z=(k=Y.response)==null?void 0:k.data)==null?void 0:z.error}`,"error"),alert(((V=(E=Y.response)==null?void 0:E.data)==null?void 0:V.error)||"Failed to delete game")}finally{Q(!1)}},D=c=>{var k;switch(c.status){case"WAITING":return`Waiting for players (${(k=c.players)==null?void 0:k.length}/${c.maxPlayers})`;case"ACTIVE":return"In progress";case"FINISHED":return"Finished";case"ABANDONED":return"Abandoned";default:return c.status}},P=c=>{switch(c){case"WAITING":return"status-waiting";case"ACTIVE":return"status-active";case"FINISHED":return"status-finished";case"ABANDONED":return"status-abandoned";default:return""}};return n?e.jsx("div",{className:"loading",children:"Loading games..."}):e.jsxs("div",{className:"territory-dashboard",children:[e.jsx("div",{className:"dashboard-bg-grid"}),e.jsxs("div",{className:"dashboard-overlay",children:[e.jsxs("header",{className:"territory-dashboard-header",children:[e.jsxs("div",{className:"dashboard-title-section",children:[e.jsx("div",{className:"dashboard-logo",children:e.jsxs("div",{className:"dashboard-logo-grid",children:[e.jsx("div",{className:"logo-cell active player1"}),e.jsx("div",{className:"logo-cell active player2"}),e.jsx("div",{className:"logo-cell active player3"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell active player1"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell active player2"}),e.jsx("div",{className:"logo-cell"}),e.jsx("div",{className:"logo-cell active player3"})]})}),e.jsxs("div",{className:"dashboard-title-text",children:[e.jsx("h1",{children:"Command Center"}),e.jsxs("p",{className:"welcome-commander",children:["Welcome back, Commander ",R==null?void 0:R.username,"!"]}),e.jsxs("div",{className:"status-indicator",children:[e.jsx("span",{className:"status-dot online"}),e.jsx("span",{className:"status-text",children:"Systems Online"})]})]})]}),e.jsxs("div",{className:"dashboard-actions",children:[e.jsxs("button",{onClick:()=>w(!0),className:"territory-btn-primary",children:[e.jsx("span",{className:"btn-icon",children:"‚öîÔ∏è"}),e.jsx("span",{children:"New Campaign"})]}),e.jsxs("button",{onClick:()=>G(!S),className:"territory-btn-secondary",style:{marginRight:"10px"},children:[e.jsx("span",{className:"btn-icon",children:"üîß"}),e.jsx("span",{children:S?"Hide Debug":"Show Debug"})]}),e.jsxs("button",{onClick:B,className:"territory-btn-logout",children:[e.jsx("span",{className:"btn-icon",children:"üö™"}),e.jsx("span",{children:"Logout"})]})]})]}),S&&e.jsxs("div",{className:"debug-panel",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"2px solid #4c51bf",borderRadius:"8px",padding:b?"20px":"10px 15px",margin:"20px 0",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",transition:"all 0.3s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:b?"15px":"0"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",color:"white",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:"üîç"})," Debug Console",e.jsxs("span",{style:{background:F.some(c=>c.type==="error")?"#ef4444":F.some(c=>c.type==="success")?"#10b981":"#3b82f6",fontSize:"12px",padding:"2px 8px",borderRadius:"12px",marginLeft:"10px"},children:[F.length," events"]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>C(!b),style:{padding:"6px 12px",fontSize:"12px",background:"rgba(255,255,255,0.2)",color:"white",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"4px",cursor:"pointer",transition:"background 0.2s"},onMouseOver:c=>c.target.style.background="rgba(255,255,255,0.3)",onMouseOut:c=>c.target.style.background="rgba(255,255,255,0.2)",children:b?"üìâ Collapse":"üìà Expand"}),b&&e.jsx("button",{onClick:()=>g([]),style:{padding:"6px 12px",fontSize:"12px",background:"rgba(239,68,68,0.2)",color:"white",border:"1px solid rgba(239,68,68,0.5)",borderRadius:"4px",cursor:"pointer",transition:"background 0.2s"},onMouseOver:c=>c.target.style.background="rgba(239,68,68,0.3)",onMouseOut:c=>c.target.style.background="rgba(239,68,68,0.2)",children:"üóëÔ∏è Clear"})]})]}),b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:"6px",padding:"10px",marginBottom:"15px",display:"flex",gap:"20px",flexWrap:"wrap"},children:[e.jsxs("div",{style:{color:"white",fontSize:"13px"},children:[e.jsx("strong",{children:"üü¢ Status:"})," ",n?"Loading...":"Ready"]}),e.jsxs("div",{style:{color:"white",fontSize:"13px"},children:[e.jsx("strong",{children:"üë§ User:"})," ",(R==null?void 0:R.username)||"Unknown"]}),e.jsxs("div",{style:{color:"white",fontSize:"13px"},children:[e.jsx("strong",{children:"üéÆ Games:"})," ",s.length]}),e.jsxs("div",{style:{color:"white",fontSize:"13px"},children:[e.jsx("strong",{children:"üåê API Base:"})," ","/territory-api"]}),e.jsxs("div",{style:{color:"white",fontSize:"13px"},children:[e.jsx("strong",{children:"üîå WebSocket:"})," ","/territory-ws"]})]}),e.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:"6px",padding:"10px",maxHeight:"250px",overflowY:"auto",fontFamily:"monospace",fontSize:"12px"},children:F.length===0?e.jsx("div",{style:{color:"rgba(255,255,255,0.6)",textAlign:"center",padding:"20px"},children:"No debug events yet. Try creating a game or performing an action."}):F.slice().reverse().map((c,k)=>e.jsxs("div",{style:{padding:"4px 8px",marginBottom:"4px",background:c.type==="error"?"rgba(239,68,68,0.2)":c.type==="success"?"rgba(16,185,129,0.2)":"rgba(59,130,246,0.2)",borderLeft:`3px solid ${c.type==="error"?"#ef4444":c.type==="success"?"#10b981":"#3b82f6"}`,borderRadius:"3px",color:"white",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"14px",minWidth:"20px"},children:c.type==="error"?"‚ùå":c.type==="success"?"‚úÖ":"üìù"}),e.jsxs("span",{style:{color:"rgba(255,255,255,0.7)",minWidth:"70px"},children:["[",c.timestamp,"]"]}),e.jsx("span",{style:{flex:1},children:c.message})]},k))}),e.jsxs("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"11px",color:"rgba(255,255,255,0.8)"},children:["üí° ",e.jsx("strong",{children:"Tip:"})," This debug console shows all API calls, errors, and system events. Keep it open while testing to diagnose issues."]})]})]}),f&&e.jsx("div",{className:"territory-modal",children:e.jsxs("div",{className:"territory-modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"üó∫Ô∏è Launch New Campaign"}),e.jsx("div",{className:"modal-subtitle",children:"Establish your territory and expand your dominion"})]}),e.jsxs("form",{onSubmit:de,className:"territory-create-form",children:[e.jsxs("div",{className:"territory-form-group",children:[e.jsxs("label",{className:"territory-label",children:[e.jsx("span",{className:"label-icon",children:"üìù"}),e.jsx("span",{children:"Campaign Name"})]}),e.jsx("input",{type:"text",placeholder:"Enter campaign name...",value:O.title,onChange:c=>X({...O,title:c.target.value}),required:!0,className:"territory-input"})]}),e.jsxs("div",{className:"campaign-info",children:[e.jsxs("div",{className:"info-header",children:[e.jsx("span",{className:"info-icon",children:"‚öîÔ∏è"}),e.jsx("span",{className:"info-title",children:"Territory Conquest"})]}),e.jsxs("div",{className:"info-features",children:[e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"üè∞"}),e.jsx("span",{children:"Real-time strategy gameplay"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"üéØ"}),e.jsx("span",{children:"Enclosed area capture mechanics"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"üë•"}),e.jsx("span",{children:"Up to 8 commanders"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"‚ö°"}),e.jsx("span",{children:"Move regeneration system"})]})]})]}),e.jsxs("div",{className:"territory-form-actions",children:[e.jsxs("button",{type:"button",onClick:()=>w(!1),className:"territory-btn-cancel",children:[e.jsx("span",{className:"btn-icon",children:"‚ùå"}),e.jsx("span",{children:"Cancel"})]}),e.jsxs("button",{type:"submit",disabled:l,className:"territory-btn-create",children:[e.jsx("span",{className:"btn-icon",children:l?"‚è≥":"üöÄ"}),e.jsx("span",{children:l?"Launching...":"Launch Campaign"})]})]})]})]})}),e.jsxs("div",{className:"territory-games-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üè∞ Active Campaigns"}),e.jsxs("div",{className:"section-stats",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("span",{className:"stat-icon",children:"üìä"}),e.jsxs("span",{className:"stat-text",children:[s.length," Total"]})]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("span",{className:"stat-icon",children:"‚ö°"}),e.jsxs("span",{className:"stat-text",children:[s.filter(c=>c.status==="ACTIVE").length," Active"]})]})]})]}),s.length===0?e.jsxs("div",{className:"territory-empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsxs("div",{className:"empty-grid",children:[e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell center",children:"?"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"}),e.jsx("div",{className:"empty-cell"})]})}),e.jsx("h3",{children:"No Campaigns Found"}),e.jsx("p",{children:"Begin your conquest by creating your first territory campaign!"}),e.jsxs("button",{onClick:()=>w(!0),className:"territory-btn-primary",children:[e.jsx("span",{className:"btn-icon",children:"‚öîÔ∏è"}),e.jsx("span",{children:"Start First Campaign"})]})]}):e.jsx("div",{className:"territory-games-grid",children:s.map(c=>{var k,z,E;return e.jsxs("div",{className:"territory-game-card",children:[e.jsxs("div",{className:"game-card-header",children:[e.jsxs("div",{className:"game-title-section",children:[e.jsx("h3",{children:c.title}),e.jsxs("div",{className:"game-type-badge",children:[e.jsx("span",{className:"badge-icon",children:"üó∫Ô∏è"}),e.jsx("span",{children:"Territory"})]})]}),e.jsxs("div",{className:`territory-status ${P(c.status)}`,children:[e.jsx("span",{className:"status-icon",children:js(c.status)}),e.jsx("span",{className:"status-label",children:D(c)})]})]}),e.jsxs("div",{className:"game-preview",children:[e.jsx("div",{className:"preview-grid",children:Array.from({length:25},(V,Y)=>e.jsx("div",{className:`preview-cell ${c.players&&c.players.length>0?Y%3===0?"occupied p1":Y%5===0?"occupied p2":"":""}`},Y))}),e.jsx("div",{className:"preview-overlay",children:e.jsx("span",{className:"preview-text",children:"Campaign Preview"})})]}),e.jsxs("div",{className:"game-info",children:[e.jsxs("div",{className:"commander-info",children:[e.jsx("span",{className:"commander-label",children:"Commander:"}),e.jsx("span",{className:"commander-name",children:c.owner.username})]}),e.jsxs("div",{className:"players-roster",children:[e.jsx("span",{className:"roster-label",children:"Forces:"}),e.jsxs("div",{className:"player-indicators",children:[(k=c.players)==null?void 0:k.slice(0,3).map((V,Y)=>e.jsx("div",{className:`player-badge p${Y+1}`,children:V.user.username.charAt(0).toUpperCase()},V.id)),c.players&&c.players.length>3&&e.jsxs("div",{className:"player-badge more",children:["+",c.players.length-3]}),!c.players||c.players.length===0&&e.jsx("div",{className:"no-players",children:"Awaiting reinforcements"})]})]})]}),e.jsxs("div",{className:"territory-game-actions",children:[e.jsxs(Ae,{to:`/${c.id}`,className:"territory-btn-play",onClick:()=>v(`Navigating to game ${c.id}`),children:[e.jsx("span",{className:"btn-icon",children:c.status==="FINISHED"?"üëÅÔ∏è":"‚ö°"}),e.jsx("span",{children:c.status==="FINISHED"?"Inspect":"Deploy"})]}),c.ownerId===(R==null?void 0:R.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>K(c.id),className:"territory-btn-secondary",disabled:((z=c.players)==null?void 0:z.length)>=8,title:((E=c.players)==null?void 0:E.length)>=8?"Maximum 8 commanders":"Recruit commander",children:[e.jsx("span",{className:"btn-icon",children:"üë•"}),e.jsx("span",{children:"Recruit"})]}),e.jsxs("button",{onClick:()=>T(c.id),className:"territory-btn-danger",title:"Abandon Campaign",children:[e.jsx("span",{className:"btn-icon",children:"üí•"}),e.jsx("span",{children:"Abandon"})]})]})]})]},c.id)})})]})]}),$&&e.jsx("div",{className:"territory-modal",children:e.jsxs("div",{className:"territory-modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"üë• Recruit Commander"}),e.jsx("div",{className:"modal-subtitle",children:"Add a new commander to your campaign"})]}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),q.trim()&&m($,q.trim())},className:"territory-recruit-form",children:[e.jsxs("div",{className:"territory-form-group",children:[e.jsxs("label",{className:"territory-label",children:[e.jsx("span",{className:"label-icon",children:"üîç"}),e.jsx("span",{children:"Commander Identifier"})]}),e.jsx("input",{type:"text",placeholder:"Enter email or username...",value:q,onChange:c=>W(c.target.value),disabled:y,autoFocus:!0,className:"territory-input"})]}),e.jsx("div",{className:"recruit-info",children:e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-icon",children:"‚ÑπÔ∏è"}),e.jsx("span",{children:"Commanders can immediately join and start conquering territory"})]})}),e.jsxs("div",{className:"territory-form-actions",children:[e.jsxs("button",{type:"button",onClick:()=>{K(null),W("")},className:"territory-btn-cancel",disabled:y,children:[e.jsx("span",{className:"btn-icon",children:"‚ùå"}),e.jsx("span",{children:"Cancel"})]}),e.jsxs("button",{type:"submit",className:"territory-btn-create",disabled:!q.trim()||y,children:[e.jsx("span",{className:"btn-icon",children:y?"‚è≥":"üë•"}),e.jsx("span",{children:y?"Recruiting...":"Recruit Commander"})]})]})]})]})}),N&&e.jsx("div",{className:"territory-modal",children:e.jsxs("div",{className:"territory-modal-content danger",children:[e.jsxs("div",{className:"modal-header danger",children:[e.jsx("h2",{children:"üí• Abandon Campaign"}),e.jsx("div",{className:"modal-subtitle",children:"This action will permanently destroy the campaign"})]}),e.jsxs("div",{className:"danger-warning",children:[e.jsx("div",{className:"warning-icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("p",{children:e.jsx("strong",{children:"This cannot be undone!"})}),e.jsx("p",{children:"All territory progress, commander data, and battle history will be lost."}),e.jsxs("div",{className:"campaign-details",children:[e.jsx("span",{className:"detail-label",children:"Campaign:"}),e.jsx("span",{className:"detail-value",children:(H=s.find(c=>c.id===N))==null?void 0:H.title})]})]})]}),e.jsxs("div",{className:"territory-form-actions danger",children:[e.jsxs("button",{type:"button",onClick:()=>T(null),className:"territory-btn-cancel",disabled:A,children:[e.jsx("span",{className:"btn-icon",children:"üõ°Ô∏è"}),e.jsx("span",{children:"Keep Campaign"})]}),e.jsxs("button",{type:"button",onClick:()=>x(N),className:"territory-btn-danger-confirm",disabled:A,children:[e.jsx("span",{className:"btn-icon",children:A?"‚è≥":"üí•"}),e.jsx("span",{children:A?"Abandoning...":"Abandon Campaign"})]})]})]})})]})},js=s=>{switch(s){case"WAITING":return"‚è≥";case"ACTIVE":return"‚ö°";case"FINISHED":return"üèÜ";case"ABANDONED":return"üíÄ";default:return"‚ùì"}},vs="/territory-ws";class bs{constructor(){this.socket=null,this.gameId=null}connect(){return this.socket||(this.socket=_e(vs,{withCredentials:!0}),this.socket.on("connect",()=>{console.log("Connected to socket server")}),this.socket.on("disconnect",()=>{console.log("Disconnected from socket server")})),this.socket}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.gameId=null)}joinGame(t){this.socket&&t!==this.gameId&&(this.gameId&&this.socket.emit("leave-game",this.gameId),this.gameId=t,this.socket.emit("join-game",t))}leaveGame(){this.socket&&this.gameId&&(this.socket.emit("leave-game",this.gameId),this.gameId=null)}emitMove(t,n){this.socket&&this.socket.emit("game-move",{gameId:t,moveData:n})}emitStateChange(t,n,r,l){this.socket&&this.socket.emit("game-state-change",{gameId:t,gameState:n,status:r,winnerId:l})}onMoveMade(t){this.socket&&this.socket.on("move-made",t)}onStateUpdated(t){this.socket&&this.socket.on("state-updated",t)}offMoveMade(t){this.socket&&this.socket.off("move-made",t)}offStateUpdated(t){this.socket&&this.socket.off("state-updated",t)}}const he=new bs,Ns=()=>{var X,$,K,q,W,y;const{id:s}=qe(),t=ke(),{user:n}=ve(),[r,l]=i.useState(null),[d,f]=i.useState(!0),[w,F]=i.useState(""),g=i.useCallback(async()=>{var p,N,T;try{console.log("üéÆ Loading game:",s,"for user:",n==null?void 0:n.username);const A=await we.getGame(s);console.log("‚úÖ Game loaded successfully:",A.data.title),l(A.data)}catch(A){console.error("‚ùå Failed to load game:",A),console.error("Error details:",{status:(p=A.response)==null?void 0:p.status,data:(N=A.response)==null?void 0:N.data,gameId:s,user:n==null?void 0:n.username}),((T=A.response)==null?void 0:T.status)===404&&(console.log("üö™ Game not found, redirecting to dashboard"),t("/dashboard"))}finally{f(!1)}},[s,t,n]);i.useEffect(()=>{g()},[g]),i.useEffect(()=>{if(r){he.connect(),he.joinGame(r.id);const p=T=>{console.log("Move made:",T),g()},N=T=>{console.log("State updated:",T),g()};return he.onMoveMade(p),he.onStateUpdated(N),()=>{he.offMoveMade(p),he.offStateUpdated(N),he.leaveGame()}}},[r,g]);const S=async p=>{var N,T;if(p.preventDefault(),!!w.trim())try{const A={action:w.trim(),timestamp:Date.now()};await we.makeMove(s,A),he.emitMove(s,A),F(""),g()}catch(A){console.error("Failed to make move:",A),alert(((T=(N=A.response)==null?void 0:N.data)==null?void 0:T.error)||"Failed to make move")}},G=async()=>{var p,N;try{await we.joinGame(s),g()}catch(T){console.error("Failed to join game:",T),alert(((N=(p=T.response)==null?void 0:p.data)==null?void 0:N.error)||"Failed to join game")}};if(d)return e.jsx("div",{className:"loading",children:"Loading game..."});if(!r)return e.jsx("div",{className:"error",children:"Game not found"});const b=(X=r.players)==null?void 0:X.some(p=>p.userId===(n==null?void 0:n.id));r.ownerId,n==null||n.id;const C=r.currentTurn===(n==null?void 0:n.id),O=($=r.players)==null?void 0:$.find(p=>p.userId===r.currentTurn);return e.jsxs("div",{className:"game-room",children:[e.jsx("header",{className:"game-header",children:e.jsxs("div",{children:[e.jsx(Ae,{to:"/dashboard",className:"back-link",children:"‚Üê Back to Dashboard"}),e.jsx("h1",{children:r.title}),e.jsxs("div",{className:"game-meta",children:[e.jsx("span",{className:"game-type",children:r.gameType}),e.jsx("span",{className:`status status-${r.status.toLowerCase()}`,children:r.status})]})]})}),e.jsxs("div",{className:"game-content",children:[e.jsxs("div",{className:"game-sidebar",children:[e.jsxs("div",{className:"players-section",children:[e.jsxs("h3",{children:["Players (",(K=r.players)==null?void 0:K.length,"/",r.maxPlayers,")"]}),e.jsx("div",{className:"players-list",children:(q=r.players)==null?void 0:q.map(p=>e.jsxs("div",{className:`player ${p.userId===r.currentTurn?"current-turn":""}`,children:[e.jsx("span",{className:"player-name",children:p.user.username}),p.userId===r.ownerId&&e.jsx("span",{className:"owner-badge",children:"Owner"}),p.userId===r.currentTurn&&e.jsx("span",{className:"turn-indicator",children:"Current Turn"})]},p.id))}),!b&&r.status==="WAITING"&&e.jsx("button",{onClick:G,className:"btn-primary",children:"Join Game"})]}),r.moves&&r.moves.length>0&&e.jsxs("div",{className:"moves-section",children:[e.jsx("h3",{children:"Game Log"}),e.jsx("div",{className:"moves-list",children:r.moves.map(p=>{var N;return e.jsxs("div",{className:"move",children:[e.jsxs("span",{className:"move-player",children:[(N=p.user)==null?void 0:N.username,":"]}),e.jsx("span",{className:"move-data",children:typeof p.moveData=="string"?p.moveData:JSON.stringify(p.moveData)})]},p.id)})})]})]}),e.jsx("div",{className:"game-main",children:e.jsxs("div",{className:"game-board",children:[r.status==="WAITING"&&e.jsxs("div",{className:"waiting-message",children:[e.jsx("h2",{children:"Waiting for players..."}),e.jsx("p",{children:"Share this URL with friends to invite them to play!"})]}),r.status==="ACTIVE"&&e.jsxs("div",{className:"game-active",children:[e.jsx("div",{className:"turn-indicator",children:C?e.jsx("h3",{children:"Your turn!"}):e.jsxs("h3",{children:["Waiting for ",O==null?void 0:O.user.username,"'s move..."]})}),r.gameState&&e.jsxs("div",{className:"game-state",children:[e.jsx("h4",{children:"Game State:"}),e.jsx("pre",{children:typeof r.gameState=="string"?r.gameState:JSON.stringify(r.gameState,null,2)})]}),b&&C&&e.jsx("div",{className:"move-input",children:e.jsxs("form",{onSubmit:S,children:[e.jsx("input",{type:"text",placeholder:"Enter your move...",value:w,onChange:p=>F(p.target.value),disabled:!C}),e.jsx("button",{type:"submit",disabled:!w.trim(),children:"Make Move"})]})})]}),r.status==="FINISHED"&&e.jsxs("div",{className:"game-finished",children:[e.jsx("h2",{children:"Game Over!"}),r.winnerId&&e.jsxs("p",{children:["Winner: ",(y=(W=r.players)==null?void 0:W.find(p=>p.userId===r.winnerId))==null?void 0:y.user.username]})]}),r.status==="ABANDONED"&&e.jsxs("div",{className:"game-abandoned",children:[e.jsx("h2",{children:"Game Abandoned"}),e.jsx("p",{children:"This game was abandoned by the players."})]})]})})]})]})},ws="/territory-ws";function Ve(){const[s,t]=i.useState(null);return i.useEffect(()=>{const n=_e(ws,{withCredentials:!0,transports:["websocket","polling"]});return n.on("connect",()=>{console.log("Socket connected:",n.id)}),n.on("disconnect",()=>{console.log("Socket disconnected")}),n.on("error",r=>{console.error("Socket error:",r)}),t(n),()=>{n.close()}},[]),s}const ae=20,Te=64,Ss=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#F4A460","#98D8C8"];function ks({gameId:s,playerColor:t,onMoveComplete:n,initialCenter:r}){const l=i.useRef(null),[d,f]=i.useState({x:(r==null?void 0:r.x)||0,y:(r==null?void 0:r.y)||0,zoom:1}),[w,F]=i.useState(new Map),[g,S]=i.useState(!1),[G,b]=i.useState({x:0,y:0}),[C,O]=i.useState(null),[X,$]=i.useState(new Set),[K,q]=i.useState(0),[W,y]=i.useState(null),[p,N]=i.useState(null),[T,A]=i.useState(new Map),[Q,R]=i.useState(null),B=Ve(),{theme:le}=Fe(),U=i.useCallback(({x:o,y:a})=>{const u=l.current;if(!u)return{x:0,y:0};const h=u.width/2,j=u.height/2;return{x:h+(o-d.x)*ae*d.zoom,y:j+(a-d.y)*ae*d.zoom}},[d]),v=i.useCallback(({x:o,y:a})=>{const u=l.current;if(!u)return{x:0,y:0};const h=u.width/2,j=u.height/2;return{x:Math.floor((o-h)/(ae*d.zoom)+d.x),y:Math.floor((a-j)/(ae*d.zoom)+d.y)}},[d]),de=i.useCallback((o,a)=>{const u=o.clientX-a.clientX,h=o.clientY-a.clientY;return Math.sqrt(u*u+h*h)},[]),m=i.useCallback((o,a)=>{var h;const u=(h=l.current)==null?void 0:h.getBoundingClientRect();return u?{x:(o.clientX+a.clientX)/2-u.left,y:(o.clientY+a.clientY)/2-u.top}:{x:0,y:0}},[]),x=i.useCallback(async()=>{const o=l.current;if(!o)return;const a=Math.ceil(Math.max(o.width,o.height)/(ae*d.zoom))+2,u=Math.floor(a/2),h={minX:Math.floor(d.x-u),maxX:Math.ceil(d.x+u),minY:Math.floor(d.y-u),maxY:Math.ceil(d.y+u)};try{const j=await ne.getRegion(s,h),L=new Map(w);for(const M in j.cells)for(const J in j.cells[M]){const re=`${M},${J}`;L.set(re,j.cells[M][J])}F(L);const I=new Set;for(let M=h.minX;M<=h.maxX;M+=Te)for(let J=h.minY;J<=h.maxY;J+=Te){const re=Math.floor(M/Te),se=Math.floor(J/Te),oe=`${re},${se}`;I.add(oe),X.has(oe)||B==null||B.emit("subscribe-chunk",{gameId:s,chunkId:oe})}X.forEach(M=>{I.has(M)||B==null||B.emit("unsubscribe-chunk",{gameId:s,chunkId:M})}),$(I)}catch(j){console.error("Failed to fetch region:",j)}},[s,d,w,X,B]),D=i.useCallback(()=>{const o=l.current,a=o==null?void 0:o.getContext("2d");if(!o||!a)return;a.clearRect(0,0,o.width,o.height);const u=getComputedStyle(document.documentElement),h=u.getPropertyValue("--bg").trim(),j=u.getPropertyValue("--grid").trim();if(a.fillStyle=h,a.fillRect(0,0,o.width,o.height),d.zoom>=.5){a.strokeStyle=j,a.globalAlpha=Math.min(1,(d.zoom-.3)/.7),a.lineWidth=1;const J=Math.ceil(Math.max(o.width,o.height)/(ae*d.zoom))+2,re=Math.floor(J/2);for(let se=-re;se<=re;se++){const oe=Math.floor(d.x+se),ue=U({x:oe,y:d.y});a.beginPath(),a.moveTo(ue.x,0),a.lineTo(ue.x,o.height),a.stroke()}for(let se=-re;se<=re;se++){const oe=Math.floor(d.y+se),ue=U({x:d.x,y:oe});a.beginPath(),a.moveTo(0,ue.y),a.lineTo(o.width,ue.y),a.stroke()}a.globalAlpha=1}const I=Math.ceil(Math.max(o.width,o.height)/(ae*d.zoom))+2,M=Math.floor(I/2);for(let J=-M;J<=M;J++)for(let re=-M;re<=M;re++){const se=Math.floor(d.x+J),oe=Math.floor(d.y+re),ue=`${se},${oe}`,De=w.get(ue),ge=U({x:se,y:oe}),xe=ae*d.zoom,fe=T.get(ue);let be=1,Ge=1;if(fe){const ye=Date.now()-fe.startTime-(fe.delay||0),Ne=fe.type==="place"?250:200;if(ye>=0&&ye<Ne){const Ie=Math.min(ye/Ne,1);fe.type==="place"?(be=.1+.9*Ie,Ge=Ie):fe.type==="flip"&&(be=1+.3*Math.sin(Ie*Math.PI))}}if(De!=null){if(a.save(),a.globalAlpha=Ge,be!==1){const ye=ge.x+xe/2,Ne=ge.y+xe/2;a.translate(ye,Ne),a.scale(be,be),a.translate(-ye,-Ne)}a.fillStyle=Ss[De]||"#333",a.fillRect(ge.x,ge.y,xe-1,xe-1),a.restore()}C&&C.x===se&&C.y===oe&&(a.strokeStyle="#fff",a.lineWidth=2,a.strokeRect(ge.x,ge.y,xe-1,xe-1),a.lineWidth=1)}a.fillStyle="#fff",a.font="14px monospace",a.fillText(`Position: ${Math.floor(d.x)}, ${Math.floor(d.y)}`,10,20),a.fillText(`Zoom: ${d.zoom.toFixed(2)}x`,10,40)},[d,w,C,U,T,le]);i.useEffect(()=>{x()},[x]),i.useEffect(()=>{r&&(r.x!==d.x||r.y!==d.y)&&(console.log("Centering map on player's first cell:",r),f(o=>({...o,x:r.x,y:r.y})))},[r]),i.useEffect(()=>{const o=()=>{const a=Date.now(),u=new Map;if(T.forEach((h,j)=>{const L=a-h.startTime-(h.delay||0),I=h.type==="place"?250:200;L<I&&u.set(j,h)}),u.size!==T.size&&A(u),u.size>0){const h=requestAnimationFrame(o);R(h)}else R(null)};if(T.size>0&&!Q){const a=requestAnimationFrame(o);R(a)}return()=>{Q&&cancelAnimationFrame(Q)}},[T,Q]);const P=i.useCallback(o=>{A(a=>new Map(a).set(o,{type:"place",startTime:Date.now(),delay:0}))},[]),H=i.useCallback((o,a)=>{const u=Date.now();A(h=>{const j=new Map(h);return o.forEach((L,I)=>{if(L!==a){const M=Math.min(I*80,1e3);j.set(L,{type:"flip",startTime:u,delay:M})}}),j})},[]);i.useEffect(()=>{const o=l.current;if(!o)return;const a=()=>{o.width=o.offsetWidth,o.height=o.offsetHeight,D()};return a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[D]),i.useEffect(()=>{D()},[D]),i.useEffect(()=>{if(!B)return;const o=a=>{if(!a.changes)return;const u=new Map(w);a.changes.forEach(h=>{const j=`${h.x},${h.y}`;u.set(j,h.ownerColour)}),F(u)};return B.on("update",o),()=>{B.off("update",o)}},[B,w]);const c=o=>{l.current.getBoundingClientRect(),o.button===0&&(S(!0),b({x:o.clientX,y:o.clientY}))},k=o=>{const a=l.current.getBoundingClientRect(),u=o.clientX-a.left,h=o.clientY-a.top;if(g){const j=(o.clientX-G.x)/(ae*d.zoom),L=(o.clientY-G.y)/(ae*d.zoom);f(I=>({...I,x:I.x-j,y:I.y-L})),b({x:o.clientX,y:o.clientY})}else{const j=v({x:u,y:h});O(j)}},z=()=>{S(!1)},E=o=>{o.preventDefault();const a=o.deltaY>0?.9:1.1;f(u=>({...u,zoom:Math.max(.1,Math.min(5,u.zoom*a))}))},V=async o=>{if(g)return;const a=l.current.getBoundingClientRect(),u=o.clientX-a.left,h=o.clientY-a.top,j=v({x:u,y:h});await ee(j.x,j.y)};i.useEffect(()=>{const o=l.current;o&&(o.zoomIn=()=>{f(a=>({...a,zoom:Math.min(5,a.zoom*1.2)}))},o.zoomOut=()=>{f(a=>({...a,zoom:Math.max(.1,a.zoom/1.2)}))},o.centerView=()=>{f({x:0,y:0,zoom:1})})},[]);const Y=o=>{if(o.touches.length===2){o.preventDefault(),S(!1),y(null);const a=o.touches[0],u=o.touches[1],h=de(a,u),j=m(a,u),L=v(j);N({initialDistance:h,initialZoom:d.zoom,center:L});return}if(o.touches.length===1){o.preventDefault();const a=o.touches[0],u=l.current.getBoundingClientRect(),h=a.clientX-u.left,j=a.clientY-u.top;y({x:h,y:j}),S(!0),b({x:a.clientX,y:a.clientY});const L=Date.now();if(L-K<300){const I=v({x:h,y:j});f(M=>({x:I.x,y:I.y,zoom:Math.min(5,M.zoom*1.5)}))}q(L)}},me=o=>{if(o.touches.length===2&&p){o.preventDefault();const a=o.touches[0],u=o.touches[1],h=de(a,u),j=m(a,u),L=h/p.initialDistance,I=Math.max(.1,Math.min(5,p.initialZoom*L));v(j);const M=I/d.zoom;f(J=>({x:p.center.x+(J.x-p.center.x)/M,y:p.center.y+(J.y-p.center.y)/M,zoom:I}));return}if(o.touches.length===1&&g&&W){o.preventDefault();const a=o.touches[0],u=(a.clientX-G.x)/(ae*d.zoom),h=(a.clientY-G.y)/(ae*d.zoom);f(j=>({...j,x:j.x-u,y:j.y-h})),b({x:a.clientX,y:a.clientY})}},Z=o=>{if(o.touches.length===0){if(o.preventDefault(),N(null),!W){S(!1);return}const a=o.changedTouches[0],u=l.current.getBoundingClientRect(),h=a.clientX-u.left,j=a.clientY-u.top;if(Math.sqrt(Math.pow(h-W.x,2)+Math.pow(j-W.y,2))<10&&g){const I=v({x:h,y:j});ee(I.x,I.y)}S(!1),y(null)}else if(o.touches.length===1&&p){N(null);const a=o.touches[0],u=l.current.getBoundingClientRect(),h=a.clientX-u.left,j=a.clientY-u.top;y({x:h,y:j}),S(!0),b({x:a.clientX,y:a.clientY})}},ee=async(o,a)=>{const u=`${o},${a}`;try{P(u);const h=await ne.makeMove(s,o,a);h!=null&&h.captured&&h.captured.length>1&&H(h.captured,u),n&&n(h)}catch(h){console.error("Failed to make move:",h),A(j=>{const L=new Map(j);return L.delete(u),L})}};return e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx("canvas",{ref:l,className:"territory-canvas",style:{width:"100%",height:"100%",cursor:g?"grabbing":"crosshair",imageRendering:"pixelated"},onMouseDown:c,onMouseMove:k,onMouseUp:z,onMouseLeave:z,onWheel:E,onClick:V,onTouchStart:Y,onTouchMove:me,onTouchEnd:Z,onContextMenu:o=>o.preventDefault()}),e.jsxs("div",{style:{position:"absolute",top:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",pointerEvents:"none"},children:["Position: ",Math.floor(d.x),", ",Math.floor(d.y),e.jsx("br",{}),"Zoom: ",d.zoom.toFixed(2),"x",e.jsx("br",{}),C&&`Target: (${C.x}, ${C.y})`]})]})}let Cs=0;const Se=[];let pe=null;const Be=(s,t="info",n=3e3)=>{const r={id:++Cs,message:s,type:t,duration:n};pe?(pe(l=>[...l,r]),setTimeout(()=>{Ze(r.id)},n)):Se.length<10&&Se.push(r)},Ze=s=>{pe&&(pe(t=>t.map(n=>n.id===s?{...n,removing:!0}:n)),setTimeout(()=>{pe(t=>t.filter(n=>n.id!==s))},300))};function Ts(){const[s,t]=i.useState([]);return i.useEffect(()=>{if(pe=t,Se.length>0){const n=Se.splice(0);t(n),n.forEach(r=>{setTimeout(()=>{Ze(r.id)},r.duration)})}return()=>{pe=null,t([]),Se.length=0}},[]),e.jsx("div",{className:"toast-container",children:s.map(n=>e.jsx("div",{className:`toast ${n.type} ${n.removing?"removing":""}`,children:n.message},n.id))})}function As({current:s,max:t,nextRegenAt:n,currentTime:r}){const l=s/t*100,d=()=>{if(!n||s>=t)return"";const f=Math.max(0,new Date(n)-r),w=Math.ceil(f/1e3);return w<=0?"Regenerating...":`+1 in ${w}s`};return e.jsxs("div",{className:"moves-bar",children:[e.jsx("div",{className:"moves-progress",children:e.jsx("div",{className:"moves-fill",style:{width:`${l}%`}})}),e.jsxs("div",{className:"moves-text",children:[s,"/",t]}),n&&s<t&&e.jsx("div",{className:"moves-regen",style:{fontSize:"10px",color:"var(--text-dim)",marginLeft:"8px"},children:d()})]})}const Es=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#F4A460","#98D8C8"];function $s({scoreboard:s,currentPlayerColor:t,lastActivePlayer:n}){const r=l=>l.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"enhanced-scoreboard",children:[e.jsx("h4",{style:{color:"var(--text)",marginBottom:"12px",fontSize:"14px"},children:"Players"}),s.map(l=>{const d=l.colour===t,f=l.colour===n;return e.jsxs("div",{className:`scoreboard-row ${d?"current-player":""} ${f?"player-acting":""}`,children:[e.jsx("div",{className:"player-swatch",style:{backgroundColor:Es[l.colour]||"#666",border:d?"2px solid var(--accent)":"1px solid var(--grid)"}}),e.jsxs("div",{className:"player-name",children:[d&&"‚òÖ ",r(l.username),d&&" (You)"]}),e.jsx("div",{className:"player-score",children:l.count||0})]},l.colour)})]})}function Ds(){const{gameId:s}=qe(),t=(m,x="info",D=null)=>{const P=new Date().toLocaleTimeString(),H={message:m,type:x,timestamp:P,data:D};y(c=>[H,...c.slice(0,19)]),console.log(`[${P}] Territory ${x.toUpperCase()}: ${m}`,D||"")},n=ke(),{user:r}=ve(),l=Ve(),{toggleTheme:d,isDark:f}=Fe(),[w,F]=i.useState(null),[g,S]=i.useState(null),[G,b]=i.useState(0),[C,O]=i.useState(null),[X,$]=i.useState([]),[K,q]=i.useState(null),[W,y]=i.useState([]),[p,N]=i.useState(!0),[T,A]=i.useState(new Date),[Q,R]=i.useState(!1),[B,le]=i.useState(!1);i.useEffect(()=>(document.body.classList.add("territory-mode"),()=>{document.body.classList.remove("territory-mode")}),[]);const U=i.useCallback(async(m=0)=>{var x,D,P,H;if(!s||!r){t(`Skipping move refresh - gameId: ${s}, user: ${r==null?void 0:r.username}`,"warning");return}try{t(`Fetching available moves for game ${s}, user ${r.username}...`);const c=await ne.getAvailableMoves(s);t(`Moves API response: ${JSON.stringify(c)}`,"success"),b(c.availableMoves||0),O(c.nextRegenAt)}catch(c){if(t("Failed to refresh moves","error",{status:(x=c.response)==null?void 0:x.status,data:(D=c.response)==null?void 0:D.data,message:c.message,retryCount:m}),((P=c.response)==null?void 0:P.status)===401&&m<3){t(`Auth token may not be synced yet, retrying in ${(m+1)*500}ms...`,"warning"),setTimeout(()=>U(m+1),(m+1)*500);return}((H=c.response)==null?void 0:H.status)===401&&(t("Unauthorized after retries - user may have logged out","warning"),b(0),O(null))}},[s,r]),v=i.useCallback(async m=>{await U(),m!=null&&m.captured&&m.captured>1?Be(`Chain capture x${m.captured}!`,"success"):Be("Territory claimed!","info")},[U]),de=i.useCallback(()=>{const m=document.querySelector(".territory-canvas");m&&m.centerView&&m.centerView()},[]);return i.useEffect(()=>{if(!s){t("No gameId provided","error");return}if(!r){t("No user logged in, skipping game initialization","warning");return}S(null),b(0),O(null),$([]),q(null),t("Reset game state for new user session"),t(`Starting territory game initialization for gameId: ${s}`),t(`Current user: ${(r==null?void 0:r.username)||"unknown"}`);const m=new AbortController;let x=!0;return(async()=>{var P,H,c,k,z,E,V,Y,me;if(B){t("Join already in progress, skipping duplicate request","warning");return}try{le(!0),t("Attempting to join territory game...");const Z=await ne.joinGame(s);if(!x)return;t("Successfully joined game!","success",Z),S(Z),Z.firstCell?t(`Player has first cell at (${Z.firstCell.x}, ${Z.firstCell.y})`,"info"):t("Player has no existing cells - new player","info");const ee=l;ee&&x?(t("Emitting join-game socket event"),ee.emit("join-game",s)):x?t("No socket connection available","warning"):t("Component unmounted, skipping socket event")}catch(Z){if(t("Join game failed","error",{status:(P=Z.response)==null?void 0:P.status,data:(H=Z.response)==null?void 0:H.data,message:Z.message}),((c=Z.response)==null?void 0:c.status)===400&&((z=(k=Z.response)==null?void 0:k.data)==null?void 0:z.error)==="Already joined this game"){t("Already joined - attempting to get player info from scoreboard");try{const ee=await ne.getScoreboard(s);if(t("Retrieved scoreboard","info",ee),!x)return;const o=ee.find(a=>a.username===(r==null?void 0:r.username));if(o){t(`Found player info in scoreboard: colour ${o.colour}`,"success"),S({colour:o.colour});const a=l;a&&x&&a.emit("join-game",s)}else t(`Player ${r==null?void 0:r.username} not found in scoreboard`,"error",ee),x&&q("Could not determine player info")}catch(ee){t("Failed to get scoreboard","error",{status:(E=ee.response)==null?void 0:E.status,data:(V=ee.response)==null?void 0:V.data,message:ee.message}),x&&q("Game not found or inaccessible")}}else t("Setting error state","error"),x&&q(((me=(Y=Z.response)==null?void 0:Y.data)==null?void 0:me.error)||"Failed to join game")}finally{le(!1)}})(),()=>{x=!1,m.abort(),t("Cleaning up game initialization"),t("Component cleanup - socket leave handled by beforeunload if needed")}},[s,r]),i.useEffect(()=>{const m=D=>{l&&s&&(t("Page unloading - emitting leave-game"),l.emit("leave-game",s))},x=()=>{document.visibilityState==="hidden"&&l&&s?t("Tab hidden - maintaining game connection"):document.visibilityState==="visible"&&l&&s&&(t("Tab visible - ensuring game connection"),l.emit("join-game",s))};return window.addEventListener("beforeunload",m),document.addEventListener("visibilitychange",x),()=>{window.removeEventListener("beforeunload",m),document.removeEventListener("visibilitychange",x)}},[l,s]),i.useEffect(()=>{if(l&&s&&g){const m=()=>{t("Socket reconnected - rejoining game room","info"),l.emit("join-game",s)};return l.on("connect",m),()=>{l.off("connect",m)}}},[l,s,g]),i.useEffect(()=>{if(s&&g&&r){t("Setting up moves refresh with player info available","info");const m=setTimeout(()=>{U()},100),x=setInterval(U,5e3);return()=>{clearTimeout(m),clearInterval(x),t("Cleared moves refresh interval and timeout")}}},[s,g,r,U]),i.useEffect(()=>{const m=async()=>{var x;if(r)try{const D=await ne.getScoreboard(s);$(D)}catch(D){console.error("Failed to fetch scoreboard:",D),((x=D.response)==null?void 0:x.status)===401&&t("Unauthorized scoreboard fetch - user may have logged out","warning")}};if(s&&r){m();const x=setInterval(m,1e4);return()=>{clearInterval(x),t("Cleared scoreboard refresh interval")}}},[s,r]),i.useEffect(()=>{if(!l)return;const m=x=>{if(x.scores){const D=x.scores.map(P=>({colour:P.colour,count:P.count,username:P.username||`Player ${P.colour}`}));$(D)}};return l.on("update",m),()=>{l.off("update",m)}},[l]),i.useEffect(()=>{const m=setInterval(()=>{A(new Date)},1e3);return()=>clearInterval(m)},[]),K?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"#1a1a1a",color:"white"},children:[e.jsx("h2",{children:"Territory Game Error"}),e.jsx("p",{children:K}),e.jsxs("div",{style:{marginTop:"20px",width:"80%",maxWidth:"800px",background:"#2a2a2a",border:"1px solid #444",borderRadius:"8px",padding:"20px",fontFamily:"monospace",fontSize:"12px",maxHeight:"400px",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h3",{style:{margin:0,color:"#4ECDC4"},children:"Debug Log"}),e.jsx("button",{onClick:()=>N(!p),style:{padding:"4px 8px",background:"#555",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:p?"Hide":"Show"})]}),p&&e.jsxs("div",{children:[W.map((m,x)=>e.jsxs("div",{style:{marginBottom:"8px",color:m.type==="error"?"#ff6b6b":m.type==="success"?"#51cf66":m.type==="warning"?"#ffd43b":"#adb5bd"},children:[e.jsxs("span",{style:{color:"#6c757d"},children:["[",m.timestamp,"]"]}),e.jsxs("span",{style:{color:m.type==="error"?"#ff6b6b":"#4ECDC4"},children:[m.type.toUpperCase(),":"]}),m.message,m.data&&e.jsx("pre",{style:{margin:"4px 0 0 20px",color:"#868e96",fontSize:"11px"},children:JSON.stringify(m.data,null,2)})]},x)),e.jsx("button",{onClick:()=>y([]),style:{marginTop:"10px",padding:"4px 8px",background:"#6c757d",color:"white",border:"none",borderRadius:"2px",cursor:"pointer"},children:"Clear Log"})]})]}),e.jsx("button",{onClick:()=>n("/dashboard"),style:{marginTop:"20px",padding:"10px 20px",background:"#4ECDC4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Back to Dashboard"})]}):e.jsxs("div",{className:"territory-game-container",children:[e.jsxs("div",{className:"floating-game-info",children:[e.jsx("button",{className:"game-info-toggle",onClick:()=>R(!Q),children:e.jsxs("div",{className:"burger-icon",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),Q&&e.jsxs("div",{className:"game-info-panel",children:[e.jsxs("div",{className:"game-info-header",children:[e.jsx("h4",{children:"Game Info"}),g&&e.jsxs("div",{className:"player-info-compact",children:[e.jsx("div",{className:"player-color-indicator-small",style:{background:g.colour!==void 0?["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#F4A460","#98D8C8"][g.colour]:"#666"}}),e.jsxs("span",{children:["#",g.colour]})]})]}),e.jsx($s,{scoreboard:X,currentPlayerColor:g==null?void 0:g.colour}),e.jsxs("div",{className:"game-info-actions",children:[e.jsxs("button",{onClick:d,className:"compact-theme-button",title:`Switch to ${f?"light":"dark"} mode`,children:[f?"‚òÄÔ∏è":"üåô"," ",f?"Light":"Dark"]}),e.jsx("button",{onClick:()=>n("/dashboard"),className:"compact-leave-button",children:"Leave Game"})]})]})]}),e.jsxs("div",{className:"territory-main-area",children:[e.jsx("div",{className:"territory-canvas-container",children:e.jsx(ks,{gameId:s,playerColor:g==null?void 0:g.colour,onMoveComplete:v,initialCenter:g==null?void 0:g.firstCell})}),e.jsx(Ts,{}),e.jsxs("div",{className:"mobile-toolbar",children:[e.jsx("button",{className:"toolbar-button",onClick:de,title:"Center View",children:"‚åñ"}),e.jsx("div",{className:"toolbar-moves",children:e.jsx(As,{current:G,max:25,nextRegenAt:C,currentTime:T})}),e.jsxs("div",{className:"toolbar-zoom",children:[e.jsx("button",{className:"toolbar-button",onTouchStart:m=>{m.preventDefault();const x=document.querySelector(".territory-canvas");x&&x.zoomOut&&x.zoomOut()},title:"Zoom Out",children:"‚àí"}),e.jsx("button",{className:"toolbar-button",onTouchStart:m=>{m.preventDefault();const x=document.querySelector(".territory-canvas");x&&x.zoomIn&&x.zoomIn()},title:"Zoom In",children:"+"})]})]})]})]})}function Is(){const{theme:s,toggleTheme:t,isDark:n}=Fe();return e.jsx("button",{className:"theme-toggle",onClick:t,title:`Switch to ${n?"light":"dark"} mode`,"aria-label":`Switch to ${n?"light":"dark"} mode`,children:n?"‚òÄÔ∏è":"üåô"})}function Ms(){return e.jsx(gs,{children:e.jsx(ps,{children:e.jsx(Qe,{basename:"/territory",children:e.jsxs("div",{className:"app",children:[e.jsx(Is,{}),e.jsxs(es,{children:[e.jsx(je,{path:"/",element:e.jsx(Ue,{to:"/dashboard",replace:!0})}),e.jsx(je,{path:"/login",element:e.jsx(xs,{})}),e.jsx(je,{path:"/signup",element:e.jsx(fs,{})}),e.jsx(je,{path:"/dashboard",element:e.jsx(Pe,{children:e.jsx(ys,{})})}),e.jsx(je,{path:"/game/:id",element:e.jsx(Pe,{children:e.jsx(Ns,{})})}),e.jsx(je,{path:"/:gameId",element:e.jsx(Pe,{children:e.jsx(Ds,{})})})]})]})})})})}Le.createRoot(document.getElementById("root")).render(e.jsx(ss.StrictMode,{children:e.jsx(Ms,{})}));
